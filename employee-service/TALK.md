# Checklist for talk about Micronaut

## Prerequisites

- Check if Docker is running
- Check if IntelliJ is running
- Adjust terminal font size (⌘ + +)
- Remove running containers

## Setup

- Explore CLI (`mn create-app --list-features`)
- Create an application through the CLI
  - Features: flyway, mariadb, data-jpa, graalvm (`--features` flag)
  - Java version: 11 (`--java-version` flag)
- Enable annotation processing in IDE
- Add Lombok dependency (shortcut: `lombok`)
- Update imports

## Create database

- Set up `docker-compose.yml`
- Add `employee-app` network
- Add database configuration (shortcut: `mariadb`)
- Add `database` network alias (shortcut: `alias`)
- Start database with `docker-compose up employee-db`
- Create table `employee` with an autogenerated ID (shortcut: `tableautoid`)
- Add name, title and startdate fields
- Create testdata (shortcut: `testemployees`)

## Configuration

- Disable schema generation
- Disable Jackson date serialization as array (shortcut: `jsondate`)
- Properly configure database settings
- Enable flyway (shortcut: `flywayconf`)

## First API

- Create `Employee`entity
- Create `EmployeeRepository`
- Create `EmployeeController`
- Run application

## Second API

- Add repository method `findById`
- Add controller method
- Add `EmployeeNotFoundException`
- Add  `EmployeeNotFoundExceptionHandler`
- Add `ErrorMessage` DTO

## GraalVM

- Explore `Dockerfile`
- Add `wait-for`
- Copy `wait-for` to image
- Adjust command to use `wait-for`
- Build application with `./gradlew assemble`
- Build Docker image with `./docker-build.sh` 
- Add application to docker compose
- Configure `DATASOURCES_DEFAULT_URL` environment variable
- Configure `DATABASE_HOST` environment variable
- Configure `DATABASE_PORT` environment variaable
- Configure port forwarding
- Configure network alias (shortcut: `alias`)
- Restart Docker compose (`docker-compose up `)
- Check application

## Common issues

- Table `employee` not found
  - Make sure that the entity has the `@Table` annotation with the same-case table name (`Employee` does not work)
  - Make sure no typo's are made. If done, prefer using name within schema generation to prevent having to write alter table statements.
- App randomly fails during startup
  - Since 2.0.0 there is an issue with MacOS when building applications
  - Will be fixed within 2.0.1
  - Just restart
- Port in use
  - Make sure to stop application before running on Docker
  - Make sure no Docker image is running when running locally
- Out of memory during docker build
  - Native image build requires at least 5GB of RAM. Properly configure Docker to allow this much (Preferences → Resourcces)
  - Can take a while to build, continue with next steps
- Communication failure with database
  - Happens sometimes when running Docker, just restart
  - Make sure username, password and database name are all correct